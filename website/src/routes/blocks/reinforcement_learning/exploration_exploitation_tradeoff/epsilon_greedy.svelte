<script>
  import Question from "$lib/Question.svelte";
  import Math from "$lib/Math.svelte";
  import Algorithm from "$lib/algorithm/Algorithm.svelte";
  import AlgorithmState from "$lib/algorithm/AlgorithmState.svelte";
  import AlgorithmIf from "$lib/algorithm/AlgorithmIf.svelte";
  import AlgorithmForAll from "$lib/algorithm/AlgorithmForAll.svelte";
  import Code from "$lib/Code.svelte";
</script>

<h1>Epsilon-Greedy</h1>
<Question
  >What strategy is commonly used to balance exploration and exploitation?</Question
>
<div class="separator" />

<p>
  Epsilon-Greedy is on the one hand the easiest strategy to balance exploration
  and exploitation and on the other hand probably the most common one.
</p>

<p>
  With the probability of <Math latex={String.raw`\epsilon`} /> the agent selects
  the greedy action and with the probability of <Math
    latex={String.raw`1 - \epsilon`}
  /> the agent selects a random action. Often :math:`\epsilon` is not constant and
  starts with a relatively high value to encourage exploration when the agent knows
  nothing about the environment. The value is decreased over time and reaches a final
  minimal value after a designated number of steps. The minimal value often lies
  in the range between 0.01 and 0.1.
</p>

<Algorithm algoName={"Epsilon-Greedy"}>
  <AlgorithmState
    >Input: bandit, action set <Math latex={String.raw`\mathcal{A}`} />, number
    of episodes <Math latex={"N"} />, learning rate <Math
      latex={String.raw`\alpha`}
    />, epsilon <Math latex={String.raw`\epsilon`} />
  </AlgorithmState>
  <AlgorithmState
    >Initialize: <Math latex={String.raw`Q(a)`} /> for all <Math
      latex={String.raw`a \in \mathcal{A}`}
    /> with zeros</AlgorithmState
  >
  <AlgorithmForAll>
    <span slot="condition">Episodes <Math latex={String.raw`n \in N`} /></span>
    <AlgorithmState
      ><Math latex={String.raw`r \leftarrow`} /> random number between 0 and 1</AlgorithmState
    >
    <AlgorithmIf>
      <Math slot="condition" latex={String.raw`r < \epsilon`} />
      <AlgorithmState
        ><Math latex={String.raw`a \leftarrow`} /> random action</AlgorithmState
      >
    </AlgorithmIf>
    <AlgorithmIf>
      <Math slot="condition" latex={String.raw`r > \epsilon`} />
      <AlgorithmState
        ><Math
          latex={String.raw`a \leftarrow \arg\max_aQ(a)`}
        /></AlgorithmState
      >
    </AlgorithmIf>
    <AlgorithmState
      ><Math latex={String.raw`r \leftarrow bandit(a)`} /></AlgorithmState
    >
    <AlgorithmState
      ><Math
        latex={String.raw`Q(a) \leftarrow Q(a) + \alpha[R - Q(a)]`}
      /></AlgorithmState
    >
  </AlgorithmForAll>
</Algorithm>

<Code
  code={`
bandit = Bandit(probs=[0.01, 0.5,  1], rewards=[1000, 10, 1])
A = [x for x in range(bandit.action_space)]
  `}
/>
<Code
  code={`
def bandit_algorithm(bandit, A, num_episodes=1000000, alpha=0.00001, epsilon=0.5):
    num_actions = len(A)
    Q = np.zeros(num_actions)
    
    for episode in range(num_episodes):
        
        if np.random.rand() < epsilon:
            action = np.random.choice(num_actions)
        else:
            action = Q.argmax()
        
        reward = bandit.step(action)
        
        Q[action] = Q[action] + alpha * (reward - Q[action])
        
        if episode % 100000 == 0:
            print(Q)
        
    return Q
  `}
/>
